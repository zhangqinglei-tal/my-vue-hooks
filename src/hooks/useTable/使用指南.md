# useTable ä½¿ç”¨æŒ‡å—

## âœ¨ åŠŸèƒ½æ¦‚è¿°

æˆ‘å·²ç»å®Œæˆäº†ä¸€ä¸ªå®Œæ•´çš„ Vue 3 Composition API è¡¨æ ¼ç®¡ç† Hookï¼ŒåŒ…å«ä¸¤ä¸ªä¸»è¦æ–¹æ³•ï¼š

### 1ï¸âƒ£ `useTableRequest` - å¤„ç† API è¯·æ±‚

**æ”¯æŒåŠŸèƒ½ï¼š**
- âœ… è‡ªå®šä¹‰è¯·æ±‚å‚æ•°
- âœ… è‡ªå®šä¹‰è¯·æ±‚å‡½æ•°ï¼ˆfetcherï¼‰
- âœ… æ˜¯å¦è‡ªåŠ¨è¯·æ±‚ï¼ˆautoFetchï¼‰
- âœ… å‚æ•°å˜åŒ–åæ˜¯å¦è‡ªåŠ¨è¯·æ±‚ï¼ˆautoFetchOnParamsChangeï¼‰
- âœ… è¯·æ±‚å‚æ•°æ˜ å°„é…ç½®ï¼ˆrequestKeyConfigï¼‰
  - å¯é…ç½®é¡µç å­—æ®µåï¼ˆpageIndexKeyï¼‰
  - å¯é…ç½®æ¯é¡µæ¡æ•°å­—æ®µåï¼ˆpageSizeKeyï¼‰
- âœ… å“åº”æ•°æ®æ˜ å°„é…ç½®ï¼ˆresponseKeyConfigï¼‰
  - å¯é…ç½®æ•°æ®å­—æ®µè·¯å¾„ï¼ˆdataKeyï¼Œæ”¯æŒç‚¹å·åˆ†éš”ï¼‰
  - å¯é…ç½®æ€»æ•°å­—æ®µè·¯å¾„ï¼ˆtotalKeyï¼Œæ”¯æŒç‚¹å·åˆ†éš”ï¼‰
  - å¯é…ç½®é¡µç å­—æ®µè·¯å¾„ï¼ˆpageIndexKeyï¼Œç”¨äºåŒæ­¥é¡µç ï¼‰
- âœ… æ”¯æŒè‡ªå®šä¹‰è¯·æ±‚å‡½æ•°ï¼ˆfetcherï¼‰
- âœ… è¯·æ±‚å‰å¤„ç†é’©å­ï¼ˆbeforeFetchï¼‰
- âœ… è¯·æ±‚åå¤„ç†é’©å­ï¼ˆafterFetchï¼‰
- âœ… é”™è¯¯å¤„ç†é’©å­ï¼ˆonErrorï¼‰
- âœ… å®Œæ•´çš„åˆ†é¡µæ”¯æŒ

### 2ï¸âƒ£ `useTableStatic` - å¤„ç†é™æ€æ•°æ®

**æ”¯æŒåŠŸèƒ½ï¼š**
- âœ… æ¥æ”¶é™æ€æ•°æ®é›†ï¼ˆæ”¯æŒå“åº”å¼ refï¼‰
- âœ… è‡ªåŠ¨è®¡ç®—åˆ†é¡µå±•ç¤º
- âœ… è‡ªå®šä¹‰è¿‡æ»¤å‡½æ•°ï¼ˆfilterFnï¼‰
- âœ… å“åº”å¼æ•°æ®æºæ”¯æŒï¼ˆæ•°æ®å˜åŒ–æ—¶è‡ªåŠ¨æ›´æ–°ï¼‰
- âœ… å®Œæ•´çš„åˆ†é¡µæ”¯æŒ

### ğŸ”„ å…±äº«çš„åˆ†é¡µå¤„ç†èƒ½åŠ›

ä¸¤ä¸ªæ–¹æ³•éƒ½å…±ç”¨åŒä¸€å¥—åˆ†é¡µå¤„ç†é€»è¾‘ï¼Œæ”¯æŒï¼š
- âœ… è‡ªå®šä¹‰å½“å‰é¡µç 
- âœ… è‡ªå®šä¹‰æ¯é¡µæ˜¾ç¤ºæ¡æ•°
- âœ… è‡ªå®šä¹‰æ¯é¡µæ¡æ•°é€‰é¡¹åˆ—è¡¨
- âœ… æ”¯æŒç¦ç”¨åˆ†é¡µï¼ˆpagination: falseï¼‰
- âœ… é¡µç åˆ‡æ¢
- âœ… æ¯é¡µæ¡æ•°åˆ‡æ¢
- âœ… è‡ªåŠ¨è®¡ç®—æ€»é¡µæ•°

## ğŸ“ æ–‡ä»¶ç»“æ„

```
src/useTable/
â”œâ”€â”€ index.ts          # ä¸»è¦å®ç°æ–‡ä»¶
â”œâ”€â”€ types.ts          # TypeScript ç±»å‹å®šä¹‰
â”œâ”€â”€ README.md         # è¯¦ç»†æ–‡æ¡£ï¼ˆè‹±æ–‡ï¼‰
â”œâ”€â”€ ä½¿ç”¨æŒ‡å—.md       # ä½¿ç”¨æŒ‡å—ï¼ˆä¸­æ–‡ï¼‰
â””â”€â”€ example.vue       # å®Œæ•´ç¤ºä¾‹
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¤ºä¾‹ 1: API è¯·æ±‚æ¨¡å¼

```vue
<script setup lang="ts">
import { reactive } from 'vue'
import { useTableRequest } from 'vue3-tools'

// æœç´¢è¡¨å•
const searchForm = reactive({
  keyword: '',
  status: 'active'
})

// ä½¿ç”¨ hook
const { 
  data,           // è¡¨æ ¼æ•°æ®ï¼ˆRef<T[]>ï¼‰
  loading,        // åŠ è½½çŠ¶æ€ï¼ˆRef<boolean>ï¼‰
  pagination,     // åˆ†é¡µçŠ¶æ€ï¼ˆRef<PaginationState>ï¼‰
  total,          // æ€»æ¡æ•°ï¼ˆRef<number>ï¼‰
  refresh,        // åˆ·æ–°ï¼ˆä¿æŒå½“å‰é¡µï¼‰
  reset,          // é‡ç½®åˆ°ç¬¬ä¸€é¡µå¹¶åˆ·æ–°
  changePage,     // åˆ‡æ¢é¡µç 
  changePageSize, // åˆ‡æ¢æ¯é¡µæ¡æ•°
  updateParams    // æ›´æ–°è¯·æ±‚å‚æ•°
} = useTableRequest({
  // å¿…éœ€ï¼šè¯·æ±‚å‡½æ•°
  fetcher: async (params) => {
    const response = await fetch('/api/users', {
      method: 'POST',
      body: JSON.stringify(params),
      headers: { 'Content-Type': 'application/json' }
    })
    return await response.json()
  },
  params: searchForm,
  autoFetch: true,
  autoFetchOnParamsChange: true,
  
  // åˆ†é¡µé…ç½®
  pagination: {
    currentPage: 1,
    pageSize: 10
  },
  
  // è¯·æ±‚å‚æ•°æ˜ å°„é…ç½®
  requestKeyConfig: {
    pageIndexKey: 'page',           // é¡µç å‚æ•°å
    pageSizeKey: 'size'             // æ¯é¡µæ¡æ•°å‚æ•°å
  },
  
  // å“åº”æ•°æ®æ˜ å°„é…ç½®
  responseKeyConfig: {
    dataKey: 'data.list',    // æ•°æ®åˆ—è¡¨å­—æ®µè·¯å¾„ï¼ˆæ”¯æŒç‚¹å·åˆ†éš”ï¼‰
    totalKey: 'data.total'   // æ€»æ•°å­—æ®µè·¯å¾„ï¼ˆæ”¯æŒç‚¹å·åˆ†éš”ï¼‰
  }
})

// æœç´¢
const handleSearch = () => {
  updateParams(searchForm)
}
</script>

<template>
  <div>
    <!-- æœç´¢è¡¨å• -->
    <input v-model="searchForm.keyword" />
    <button @click="handleSearch">æœç´¢</button>
    
    <!-- è¡¨æ ¼ -->
    <table v-loading="loading">
      <tr v-for="item in data" :key="item.id">
        <td>{{ item.name }}</td>
      </tr>
    </table>
    
    <!-- åˆ†é¡µå™¨ -->
    <div v-if="pagination">
      <button @click="changePage(pagination.currentPage - 1)">ä¸Šä¸€é¡µ</button>
      <span>{{ pagination.currentPage }}</span>
      <button @click="changePage(pagination.currentPage + 1)">ä¸‹ä¸€é¡µ</button>
      <span>å…± {{ total }} æ¡</span>
    </div>
  </div>
</template>
```

### ç¤ºä¾‹ 2: é™æ€æ•°æ®æ¨¡å¼

```vue
<script setup lang="ts">
import { ref, reactive } from 'vue'
import { useTableStatic } from 'vue3-tools'

// æ‰€æœ‰æ•°æ®
const allData = ref([
  { id: 1, name: 'å¼ ä¸‰', age: 25, city: 'åŒ—äº¬' },
  { id: 2, name: 'æå››', age: 30, city: 'ä¸Šæµ·' },
  // ... æ›´å¤šæ•°æ®
])

// æœç´¢å‚æ•°ï¼ˆåœ¨å¤–éƒ¨ç®¡ç†ï¼‰
const searchParams = reactive({
  keyword: '',
  city: ''
})

// ä½¿ç”¨ hook
const { 
  data,                 // å½“å‰é¡µæ•°æ®ï¼ˆRef<T[]>ï¼‰
  loading,             // åŠ è½½çŠ¶æ€ï¼ˆRef<boolean>ï¼‰
  pagination,          // åˆ†é¡µçŠ¶æ€ï¼ˆRef<PaginationState>ï¼‰
  total,               // æ€»æ¡æ•°ï¼ˆè¿‡æ»¤åï¼ŒRef<number>ï¼‰
  refresh,             // åˆ·æ–°
  changePage,          // åˆ‡æ¢é¡µç 
  changePageSize       // åˆ‡æ¢æ¯é¡µæ¡æ•°
} = useTableStatic({
  data: allData,
  
  // è‡ªå®šä¹‰è¿‡æ»¤å‡½æ•°ï¼ˆä½¿ç”¨å¤–éƒ¨å®šä¹‰çš„ searchParamsï¼‰
  filterFn: (item) => {
    // å…³é”®è¯æœç´¢
    if (searchParams.keyword && !item.name.includes(searchParams.keyword)) {
      return false
    }
    // åŸå¸‚ç­›é€‰
    if (searchParams.city && item.city !== searchParams.city) {
      return false
    }
    return true
  },
  
  // åˆ†é¡µé…ç½®
  pagination: {
    pageSize: 10
  }
})

// ç›‘å¬æœç´¢å‚æ•°å˜åŒ–ï¼Œé‡æ–°ç­›é€‰
watch(
  () => [searchParams.keyword, searchParams.city],
  () => {
    refresh() // åˆ·æ–°æ•°æ®
  }
)
</script>

<template>
  <div>
    <!-- æœç´¢è¡¨å• -->
    <input v-model="searchParams.keyword" @input="handleSearch" />
    <select v-model="searchParams.city" @change="handleSearch">
      <option value="">å…¨éƒ¨åŸå¸‚</option>
      <option value="åŒ—äº¬">åŒ—äº¬</option>
      <option value="ä¸Šæµ·">ä¸Šæµ·</option>
    </select>
    
    <!-- è¡¨æ ¼ -->
    <table>
      <tr v-for="item in data" :key="item.id">
        <td>{{ item.name }}</td>
        <td>{{ item.city }}</td>
      </tr>
    </table>
    
    <!-- åˆ†é¡µå™¨ -->
    <div v-if="pagination">
      <button @click="changePage(pagination.currentPage - 1)">ä¸Šä¸€é¡µ</button>
      <span>{{ pagination.currentPage }}</span>
      <button @click="changePage(pagination.currentPage + 1)">ä¸‹ä¸€é¡µ</button>
      <span>å…± {{ total }} æ¡</span>
    </div>
  </div>
</template>
```

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§è¯´æ˜

### 1. å­—æ®µæ˜ å°„é…ç½®

æ”¯æŒæ·±å±‚è·¯å¾„è®¿é—®ï¼Œä¾‹å¦‚ï¼š

```typescript
responseKeyConfig: {
  dataKey: 'data.result.list',  // æ”¯æŒå¤šå±‚çº§è®¿é—®ï¼ˆç‚¹å·åˆ†éš”ï¼‰
  totalKey: 'data.result.total'
}
```

å¯¹åº”çš„å“åº”æ ¼å¼ï¼š
```json
{
  "data": {
    "result": {
      "list": [...],
      "total": 100
    }
  }
}
```

### 2. è‡ªå®šä¹‰è¯·æ±‚å‡½æ•°

`fetcher` æ˜¯å¿…éœ€å‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨ä»»ä½•è¯·æ±‚åº“ï¼š

```typescript
import axios from 'axios'

useTableRequest({
  fetcher: async (params) => {
    // ä½¿ç”¨è‡ªå®šä¹‰çš„è¯·æ±‚é€»è¾‘
    const response = await axios.post('/api/users', params)
    return response.data
  }
})
```

### 3. è¯·æ±‚ç”Ÿå‘½å‘¨æœŸé’©å­

```typescript
useTableRequest({
  fetcher: async (params) => {
    const response = await fetch('/api/users', {
      method: 'POST',
      body: JSON.stringify(params),
      headers: { 'Content-Type': 'application/json' }
    })
    return await response.json()
  },
  
  // è¯·æ±‚å‰ï¼šå¯ä»¥ä¿®æ”¹å‚æ•°
  beforeFetch: (params) => {
    return {
      ...params,
      timestamp: Date.now()
    }
  },
  
  // è¯·æ±‚åï¼šå¯ä»¥è½¬æ¢æ•°æ®
  afterFetch: (data) => {
    return data.map(item => ({
      ...item,
      fullName: `${item.firstName} ${item.lastName}`
    }))
  },
  
  // é”™è¯¯å¤„ç†
  onError: (error) => {
    console.error(error)
    showErrorMessage('åŠ è½½å¤±è´¥')
  }
})
```

### 4. å“åº”å¼æ•°æ®æº

é™æ€æ•°æ®æ¨¡å¼æ”¯æŒå“åº”å¼ refï¼Œæ•°æ®å˜åŒ–æ—¶ä¼šè‡ªåŠ¨æ›´æ–°ï¼š

```typescript
const users = ref([...])

const table = useTableStatic({
  data: users  // ä¼ å…¥ ref
})

// æ•°æ®å˜åŒ–æ—¶ï¼Œè¡¨æ ¼ä¼šè‡ªåŠ¨æ›´æ–°
users.value.push({ id: 3, name: 'æ–°ç”¨æˆ·' })
```

### 5. å“åº”æ€§ä¿æŒ

ä½¿ç”¨è§£æ„æ–¹å¼æ—¶ï¼Œå“åº”æ€§ä¼šä¿æŒï¼š

```typescript
// âœ… è§£æ„ä½¿ç”¨ï¼Œå“åº”æ€§ä¿æŒ
const { data, pagination, refresh } = useTableStatic({ data: sourceData })

// åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨ï¼ˆè‡ªåŠ¨è§£åŒ…ï¼‰
// <div v-for="item in data">{{ item.name }}</div>

// åœ¨ script ä¸­ä½¿ç”¨ï¼ˆéœ€è¦ .valueï¼‰
watch(() => data.value, (newData) => {
  console.log('æ•°æ®å˜åŒ–:', newData)
})
```

### 6. åˆ†é¡µæ§åˆ¶

ä¸¤ä¸ªæ–¹æ³•éƒ½æ”¯æŒå®Œæ•´çš„åˆ†é¡µæ§åˆ¶ï¼š

```typescript
// ç¦ç”¨åˆ†é¡µï¼ˆè·å–æ‰€æœ‰æ•°æ®ï¼‰
pagination: false

// è‡ªå®šä¹‰åˆ†é¡µé…ç½®
pagination: {
  currentPage: 1,
  pageSize: 20,
  pageSizesList: [10, 20, 50, 100]
}
```

## ğŸ“Š å¯¹æ¯” TableRef ç»„ä»¶

| ç‰¹æ€§ | TableRef (ç»„ä»¶) | useTable (Hooks) |
|------|----------------|------------------|
| ä½¿ç”¨æ–¹å¼ | Vue ç»„ä»¶ | Composition API |
| çµæ´»æ€§ | ä¸­ç­‰ | é«˜ |
| UI è§£è€¦ | ç»‘å®š Element Plus | å®Œå…¨è§£è€¦ |
| é€»è¾‘å¤ç”¨ | è¾ƒéš¾ | å®¹æ˜“ |
| ç±»å‹æ¨æ–­ | ä¸€èˆ¬ | å®Œæ•´ |
| è‡ªå®šä¹‰èƒ½åŠ› | æœ‰é™ | å¼ºå¤§ |

**useTable çš„ä¼˜åŠ¿ï¼š**
- âœ… å®Œå…¨çš„ UI æ¡†æ¶æ— å…³æ€§
- âœ… æ›´å¥½çš„é€»è¾‘å¤ç”¨
- âœ… æ›´çµæ´»çš„å®šåˆ¶èƒ½åŠ›
- âœ… æ›´å¥½çš„ TypeScript æ”¯æŒ
- âœ… å¯ä»¥ä¸ä»»ä½•è¡¨æ ¼ç»„ä»¶é…åˆä½¿ç”¨

## ğŸ”§ é«˜çº§ç”¨æ³•

### é…åˆ Element Plus

```vue
<template>
  <el-table :data="data" v-loading="loading">
    <el-table-column prop="name" label="å§“å" />
  </el-table>
  
  <el-pagination
    v-model:current-page="pagination.currentPage"
    v-model:page-size="pagination.pageSize"
    :total="total"
    @current-change="changePage"
    @size-change="changePageSize"
  />
  
  <!-- æ³¨æ„ï¼špagination æ˜¯ Ref ç±»å‹ï¼Œåœ¨æ¨¡æ¿ä¸­ä¼šè‡ªåŠ¨è§£åŒ… -->
</template>
```

### é…åˆ Ant Design Vue

```vue
<template>
  <a-table 
    :dataSource="data" 
    :loading="loading"
    :pagination="{
      current: pagination.currentPage,
      pageSize: pagination.pageSize,
      total: total,
      onChange: changePage,
      onShowSizeChange: changePageSize
    }"
  >
    <a-table-column key="name" title="å§“å" dataIndex="name" />
  </a-table>
</template>
```

### å¤šä¸ªè¡¨æ ¼å…±å­˜

```vue
<script setup lang="ts">
const table1 = useTableRequest({ url: '/api/users' })
const table2 = useTableRequest({ url: '/api/orders' })
const table3 = useTableStatic({ data: staticData })

// æ¯ä¸ªè¡¨æ ¼ç‹¬ç«‹ç®¡ç†
</script>
```

## ğŸ“ å®Œæ•´ç¤ºä¾‹

æŸ¥çœ‹ `example.vue` æ–‡ä»¶è·å–å®Œæ•´çš„å¯è¿è¡Œç¤ºä¾‹ï¼ŒåŒ…æ‹¬ï¼š
- API è¯·æ±‚æ¨¡å¼çš„å®Œæ•´æ¼”ç¤º
- é™æ€æ•°æ®æ¨¡å¼çš„å®Œæ•´æ¼”ç¤º
- æœç´¢ã€ç­›é€‰ã€åˆ†é¡µçš„äº¤äº’é€»è¾‘
- æ ·å¼å’Œ UI å±•ç¤º

## ğŸ‰ æ€»ç»“

è¿™ä¸ª `useTable` hooks æä¾›äº†ï¼š

1. **ä¸¤ä¸ªå¼ºå¤§çš„æ–¹æ³•**
   - `useTableRequest`: å¤„ç† API è¯·æ±‚
   - `useTableStatic`: å¤„ç†é™æ€æ•°æ®

2. **å®Œæ•´çš„åŠŸèƒ½æ”¯æŒ**
   - âœ… æ‰€æœ‰éœ€æ±‚çš„åŠŸèƒ½éƒ½å·²å®ç°
   - âœ… å…±äº«çš„åˆ†é¡µå¤„ç†èƒ½åŠ›
   - âœ… çµæ´»çš„é…ç½®é€‰é¡¹
   - âœ… å®Œæ•´çš„ TypeScript ç±»å‹æ”¯æŒ

3. **ä¼˜ç§€çš„å¼€å‘ä½“éªŒ**
   - ğŸ“– è¯¦ç»†çš„æ–‡æ¡£å’Œç¤ºä¾‹
   - ğŸ¯ æ¸…æ™°çš„ API è®¾è®¡
   - ğŸ’ª å¼ºå¤§çš„æ‰©å±•èƒ½åŠ›
   - ğŸš€ å¼€ç®±å³ç”¨

ä½ ç°åœ¨å¯ä»¥åœ¨é¡¹ç›®ä¸­ä½¿ç”¨è¿™ä¸ª hooks æ¥è½»æ¾ç®¡ç†è¡¨æ ¼æ•°æ®äº†ï¼

